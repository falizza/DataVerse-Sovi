---
title: "Laporan Analisis Regresi Linier"
output: pdf_document
params:
  model: NULL
  y_var: NULL
  x_vars: NULL
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(car)
library(lmtest)
```

# Variabel
- Variabel Dependen (Y):  `r params$y_var`
- Variabel Independen (X): `r paste(params$x_vars, collapse = ", ")`

# Model Regresi
```{r}
if (!is.null(params$model)) {
  cat("```\n")
  print(summary(params$model))
  cat("```\n")
}
```

# Uji Asumsi
## Multikolinearitas
```{r}
if (length(coef(params$model)) > 2) {
  cat("```\n")
  print(vif(params$model))
  cat("```\n")
} else {
  cat("VIF tidak dihitung untuk satu variabel X.")
}
```

## Normalitas Residual
```{r}
cat("```\n")
print(shapiro.test(resid(params$model)))
cat("```\n")
```

```{r}
plot(params$model, which = 2)
```

## Homoskedastisitas (Breusch-Pagan)
```{r}
cat("```\n")
print(bptest(params$model))
cat("```\n")
```

```{r}
plot(params$model, which = 1)
```

# Interpretasi
```{r}
model <- params$model
model_summary <- summary(model)

p_shapiro <- shapiro.test(resid(model))$p.value
p_bp <- bptest(model)$p.value
vif_vals <- if(length(coef(model)) > 2) vif(model) else c(0)
adj_r_sq <- model_summary$adj.r.squared
f_stat <- model_summary$fstatistic
p_f_stat <- if(!is.null(f_stat)) pf(f_stat[1], f_stat[2], f_stat[3], lower.tail = FALSE) else 1
coef_summary <- model_summary$coefficients

interpretasi_coef <- ""
for (i in 2:nrow(coef_summary)) {
  var_name <- rownames(coef_summary)[i]
  estimate <- coef_summary[i, 1]
  p_val <- coef_summary[i, 4]
  if (!is.na(p_val) && p_val < 0.05) {
    arah <- if(estimate > 0) "menaikkan" else "menurunkan"
    interpretasi_coef <- paste0(interpretasi_coef, "- Variabel ", var_name, " secara signifikan berpengaruh. Setiap kenaikan satu unit pada ", var_name, " akan ", arah, " ", params$y_var, " sebesar ", round(estimate, 4), ".\n")
  }
}
if (interpretasi_coef == "") {
  interpretasi_coef <- "Tidak ada variabel independen yang berpengaruh signifikan.\n"
}

# Gabungkan semua teks menjadi satu variabel tunggal
full_interpretation <- paste(
  "Ringkasan Uji Asumsi:\n\n",
  paste0("- Multikolinearitas: ", if(any(vif_vals > 10)) "Asumsi Terlanggar (VIF > 10).\n" else "Asumsi Terpenuhi (VIF < 10).\n"),
  paste0("- Normalitas Residual: ", if(!is.na(p_shapiro) && p_shapiro < 0.05) "Tidak Normal (p < 0.05) alias Asumsi Terlanggar.\n" else "Normal (p >= 0.05) alias Asumsi Terpenuhi.\n"),
  paste0("- Homoskedastisitas: ", if(!is.na(p_bp) && p_bp < 0.05) "Heteroskedastisitas (p < 0.05) alias Asumsi Terlanggar.\n\n" else "Homoskedastisitas (p >= 0.05) alias Asumsi Terpenuhi.\n\n"),
  "Interpretasi Model:\n\n",
  paste0("- Kelayakan Model (Uji-F): Model secara keseluruhan ", if(!is.na(p_f_stat) && p_f_stat < 0.05) "layak" else "tidak layak", " untuk digunakan (p = ", round(p_f_stat, 4), ").\n"),
  paste0("- Koefisien Determinasi (Adjusted R-squared): Sebesar ", round(adj_r_sq * 100, 2), "% keragaman pada variabel '", params$y_var, "' dapat dijelaskan oleh model ini.\n\n"),
  "Interpretasi Koefisien (Variabel yang Signifikan):\n\n",
  interpretasi_coef
)
```

`r full_interpretation`